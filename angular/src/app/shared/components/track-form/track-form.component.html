<form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-5">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
    <div class="space-y-2">
      <label class="block text-sm font-medium text-zinc-300">
        Title <span class="text-crimson-500">*</span>
      </label>
      <input
        type="text"
        formControlName="title"
        placeholder="Enter track title"
        class="w-full px-4 py-2.5 bg-zinc-800 border border-zinc-700 rounded-lg text-white placeholder-zinc-500 focus:outline-none focus:border-crimson-500 focus:ring-1 focus:ring-crimson-500 transition-colors"
        [class.border-red-500]="form.get('title')?.invalid && form.get('title')?.touched"
      />
      @if (form.get('title')?.touched && titleError) {
        <p class="text-sm text-red-500">{{ titleError }}</p>
      }
    </div>

    <div class="space-y-2">
      <label class="block text-sm font-medium text-zinc-300">
        Artist <span class="text-crimson-500">*</span>
      </label>
      <input
        type="text"
        formControlName="artist"
        placeholder="Enter artist name"
        class="w-full px-4 py-2.5 bg-zinc-800 border border-zinc-700 rounded-lg text-white placeholder-zinc-500 focus:outline-none focus:border-crimson-500 focus:ring-1 focus:ring-crimson-500 transition-colors"
        [class.border-red-500]="form.get('artist')?.invalid && form.get('artist')?.touched"
      />
      @if (form.get('artist')?.touched && artistError) {
        <p class="text-sm text-red-500">{{ artistError }}</p>
      }
    </div>
  </div>

  <div class="space-y-2">
    <label class="block text-sm font-medium text-zinc-300">Category</label>
    <select
      formControlName="category"
      class="w-full px-4 py-2.5 bg-zinc-800 border border-zinc-700 rounded-lg text-white focus:outline-none focus:border-crimson-500 focus:ring-1 focus:ring-crimson-500 transition-colors"
    >
      @for (cat of categories; track cat.value) {
        <option [value]="cat.value">{{ cat.label }}</option>
      }
    </select>
  </div>

  <div class="space-y-2">
    <label class="block text-sm font-medium text-zinc-300">Description</label>
    <textarea
      formControlName="description"
      placeholder="Enter track description (optional)"
      rows="3"
      class="w-full px-4 py-2.5 bg-zinc-800 border border-zinc-700 rounded-lg text-white placeholder-zinc-500 focus:outline-none focus:border-crimson-500 focus:ring-1 focus:ring-crimson-500 transition-colors resize-none"
      [class.border-red-500]="form.get('description')?.invalid && form.get('description')?.touched"
    ></textarea>
    <div class="flex justify-between text-xs text-zinc-500">
      @if (form.get('description')?.touched && descriptionError) {
        <span class="text-red-500">{{ descriptionError }}</span>
      } @else {
        <span></span>
      }
      <span [class.text-red-500]="descriptionLength > 200">{{ descriptionLength }}/200</span>
    </div>
  </div>

  <div class="space-y-2">
    <label class="block text-sm font-medium text-zinc-300">
      Audio File @if (!isEditMode) { <span class="text-crimson-500">*</span> }
    </label>
    @if (!audioFileName()) {
      <label
        class="flex flex-col items-center justify-center gap-2 p-6 border-2 border-dashed border-zinc-700 rounded-lg cursor-pointer hover:border-crimson-500/50 hover:bg-zinc-800/50 transition-colors"
        [class.border-red-500]="audioError()"
      >
        <ng-icon name="lucideUpload" size="32" class="text-zinc-500"></ng-icon>
        <span class="text-sm text-zinc-400">Click to upload audio file</span>
        <span class="text-xs text-zinc-500">MP3, WAV, OGG (max 10MB)</span>
        <input
          type="file"
          accept=".mp3,.wav,.ogg,audio/mpeg,audio/wav,audio/ogg"
          class="hidden"
          (change)="onAudioSelect($event)"
        />
      </label>
    } @else {
      <div class="flex items-center gap-3 p-3 bg-zinc-800 rounded-lg border border-zinc-700">
        <div class="p-2 bg-crimson-500/20 rounded-lg">
          <ng-icon name="lucideMusic" size="20" class="text-crimson-500"></ng-icon>
        </div>
        <span class="flex-1 text-sm text-zinc-300 truncate">{{ audioFileName() }}</span>
        <button
          type="button"
          class="p-1.5 rounded-lg hover:bg-zinc-700 text-zinc-400 hover:text-white transition-colors"
          (click)="removeAudio()"
        >
          <ng-icon name="lucideX" size="18"></ng-icon>
        </button>
      </div>
    }
    @if (audioError()) {
      <p class="text-sm text-red-500">{{ audioError() }}</p>
    }
  </div>

  <div class="space-y-2">
    <label class="block text-sm font-medium text-zinc-300">Cover Image (optional)</label>
    @if (!coverPreview()) {
      <label
        class="flex flex-col items-center justify-center gap-2 p-6 border-2 border-dashed border-zinc-700 rounded-lg cursor-pointer hover:border-crimson-500/50 hover:bg-zinc-800/50 transition-colors"
        [class.border-red-500]="coverError()"
      >
        <ng-icon name="lucideImage" size="32" class="text-zinc-500"></ng-icon>
        <span class="text-sm text-zinc-400">Click to upload cover image</span>
        <span class="text-xs text-zinc-500">PNG, JPEG (max 10MB)</span>
        <input
          type="file"
          accept=".png,.jpg,.jpeg,image/png,image/jpeg"
          class="hidden"
          (change)="onCoverSelect($event)"
        />
      </label>
    } @else {
      <div class="relative w-32 h-32">
        <img [src]="coverPreview()" alt="Cover preview" class="w-full h-full object-cover rounded-lg" />
        <button
          type="button"
          class="absolute -top-2 -right-2 p-1.5 bg-zinc-800 rounded-full hover:bg-zinc-700 text-zinc-400 hover:text-white transition-colors border border-zinc-700"
          (click)="removeCover()"
        >
          <ng-icon name="lucideX" size="14"></ng-icon>
        </button>
      </div>
    }
    @if (coverError()) {
      <p class="text-sm text-red-500">{{ coverError() }}</p>
    }
  </div>

  <div class="flex items-center justify-end gap-3 pt-4 border-t border-zinc-800">
    <button
      type="button"
      class="px-5 py-2.5 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-white font-medium transition-colors"
      (click)="onCancel()"
      [disabled]="isLoading()"
    >
      Cancel
    </button>
    <button
      type="submit"
      class="px-5 py-2.5 rounded-lg bg-crimson-600 hover:bg-crimson-700 text-white font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
      [disabled]="isLoading()"
    >
      @if (isLoading()) {
        <ng-icon name="lucideLoader" size="18" class="animate-spin"></ng-icon>
      }
      {{ isEditMode ? 'Update Track' : 'Add Track' }}
    </button>
  </div>
</form>
