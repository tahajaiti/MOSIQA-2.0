<div
  class="group relative flex items-center gap-4 p-3 rounded-xl bg-zinc-900/50 hover:bg-zinc-800/80 border border-zinc-800/50 hover:border-crimson-500/30 transition-all duration-200 cursor-pointer"
  [class.border-crimson-500]="isCurrentTrack"
  [class.bg-zinc-800/80]="isCurrentTrack"
  (click)="onCardClick()"
>
  <div class="relative w-14 h-14 rounded-lg overflow-hidden bg-zinc-800 shrink-0">
    @if (coverUrl()) {
      <img [src]="coverUrl()" alt="Cover" class="w-full h-full object-cover" />
    } @else {
      <div class="w-full h-full flex items-center justify-center bg-linear-to-br from-crimson-600/20 to-zinc-800">
        <ng-icon name="lucideMusic" size="24" class="text-crimson-500"></ng-icon>
      </div>
    }
    <button
      class="absolute inset-0 flex items-center justify-center bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity"
      (click)="togglePlay($event)"
    >
      <ng-icon [name]="isPlaying ? 'lucidePause' : 'lucidePlay'" size="24" class="text-white"></ng-icon>
    </button>
  </div>

  <div class="flex-1 min-w-0">
    <h3
      class="text-white font-medium truncate"
      [class.text-crimson-500]="isCurrentTrack"
    >
      {{ track().title }}
    </h3>
    <p class="text-sm text-zinc-400 truncate">{{ track().artist }}</p>
  </div>

  <div class="flex items-center gap-3">
    <span class="text-sm text-zinc-500 tabular-nums">{{ track().duration | duration }}</span>
    <span class="text-xs px-2 py-1 rounded-full bg-zinc-800 text-zinc-400 capitalize hidden sm:block">
      {{ track().category }}
    </span>

    @if (isInQueue && !isCurrentTrack) {
      <span class="text-xs px-2 py-1 rounded-full bg-crimson-500/20 text-crimson-400 hidden sm:block">
        In Queue
      </span>
    }

    <div class="relative">
      <button
        class="p-2 rounded-lg hover:bg-zinc-700 transition-colors text-zinc-400 hover:text-white opacity-0 group-hover:opacity-100"
        (click)="toggleMenu($event)"
      >
        <ng-icon name="lucideMoreVertical" size="18"></ng-icon>
      </button>

      @if (showMenu()) {
        <div
          class="absolute right-0 top-full mt-1 py-1 w-44 bg-zinc-800 border border-zinc-700 rounded-lg shadow-xl z-20"
          (mouseleave)="closeMenu()"
        >
          @if (!isInQueue) {
            <button
              class="w-full flex items-center gap-2 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-700 hover:text-white transition-colors"
              (click)="onAddToQueue($event)"
            >
              <ng-icon name="lucideListPlus" size="16"></ng-icon>
              Add to Queue
            </button>
          }
          <button
            class="w-full flex items-center gap-2 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-700 hover:text-white transition-colors"
            (click)="onViewDetails($event)"
          >
            <ng-icon name="lucideExternalLink" size="16"></ng-icon>
            View Details
          </button>
          <button
            class="w-full flex items-center gap-2 px-3 py-2 text-sm text-zinc-300 hover:bg-zinc-700 hover:text-white transition-colors"
            (click)="onEdit($event)"
          >
            <ng-icon name="lucidePencil" size="16"></ng-icon>
            Edit
          </button>
          <button
            class="w-full flex items-center gap-2 px-3 py-2 text-sm text-red-400 hover:bg-red-500/20 hover:text-red-300 transition-colors"
            (click)="onDelete($event)"
          >
            <ng-icon name="lucideTrash2" size="16"></ng-icon>
            Delete
          </button>
        </div>
      }
    </div>
  </div>
</div>
